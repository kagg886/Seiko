# 零.引言

- 本伪代码大部分和**SQ系**写法类似。Seiko力求低成本迁移你之前的伪代码  
  同时引入新的变量伪代码等来完善写法。
- 本伪代码模块仍处于初级阶段。如有需求请火速issue

# 一.导入

- 将你的伪代码文件移入`/sdcard/Android/data/com.kagg886.seiko/dic`中
- 前往伪代码页面，下拉刷新

# 二.编写工具

推荐MT管理器，当然其他的随便。萝卜白菜，各有所好

# 三.伪代码的基本格式:(以后会改)

一份Seiko伪代码文档由若干个指令构成，其中一份指令领导着若干伪代码。

## 0.词库信息头

每一个词库的**第一行(或第一个非空行)**都需要开始编写词库信息头，词库信息头的格式为`#内容`

每个词库都需要拥有的头为`Seiko词库`

通俗一点，一个词库是这样子的:

```text
#Seiko词库
#信息头1
#信息头2

[群]指令1
...实现1
```

信息头会存入全局变量中，在词库中可以使用`取全局变量`函数获取。

以下为可用头列表(打`*`为必选项):

| 头         | 功能                                                  |
| ---------- | ----------------------------------------------------- |
| *Seiko词库 | 标识此词库来自于Seiko<br />某种程度上可以预防编码问题 |

## 1.指令

指令由两部分构成: 事件类型(以后简称事件)和指令。格式如下:
`[事件类型]指令` 

其中，`事件类型`是一个字符串，指的是此指令在哪个事件下会被匹配 。
`指令`是 [正则表达式](https://www.runoob.com/regexp/regexp-syntax.html)，当用户在规定的事件下发送能匹配正则表达式的指令，则伪代码将会被触发。
你可以使用复合写法，例如按照下面的写法可以同时匹配群和好友命令。 
_不只是只能写两个，后期更新事件时，想追加多少就可以追加多少_
例如`[群|好友]早上好`可以匹配每一个在群内(或在bot的私聊中)发送早上好的人

**以下是支持的事件列表(以后会补充)**

| 事件匹配字符串 | 详情                                                         | 补充                       |
| -------------- | ------------------------------------------------------------ | -------------------------- |
| 群             | 代表一个群消息                                               | 无                         |
| 群事件         | 代表一个群事件，与群成员有关                                 | 详见下方对群事件标签的说明 |
| 好友           | 代表一个好友消息                                             | 无                         |
| 函数           | 代表一个可以被伪代码本体和伪代码引擎调用的函数<br />例如`调用`和`生命周期`方法 | 详见下方调用函数           |

> [你可以在这里找到内建事件匹配的所有字符串和他们对应的Mirai事件](src/main/java/com/kagg886/seiko/dic/entity/DictionaryCommandMatcher.java)

> ## 关于[群事件]的说明
>
> 群事件的指令必须为固定值才能进行解析,下列为可用的指令:
>
> | 指令           | 解释                 | 增加的内置变量               |
> | -------------- | -------------------- | ---------------------------- |
> | 成员被踢       | 成员被主动踢出       | `%操作人%`——获得踢掉成员的QQ |
> | 成员主动退群   | 成员主动退出群聊     | 无                           |
> | 成员邀请入群   | 成员被邀请加入群聊   | `%邀请人%`——获得邀请人QQ     |
> | 成员主动入群   | 成员主动加入群聊     | 无                           |
> | 群主恢复解散群 | 群主将已解散的群恢复 | 无                           |
>
> 以下为监听群成员退群的例子，监听其他事件同理:
>
> ```text
> [群事件]成员被踢
> 有人被踢\n
> 群号:%群号%\n
> QQ:%昵称%(%QQ%)\n
> 操作人:%操作人%
> ```
>
> ## 关于[生命周期]的说明
>
> 生命周期的指令必须为固定值才能进行解析，以下为可用的指令:
>
> | 指令   | 解释                                                         | 增加的内置变量 |
> | ------ | ------------------------------------------------------------ | -------------- |
> | 初始化 | 词库被加载后调用次函数                                       | 无             |
> | 被销毁 | 词库被卸载后调用次函数<br />若词库被刷新则先调用`被销毁`再调用`初始化` | 无             |
>
> 注意:
>
> 1. 生命周期函数内写入的纯文本会打印到Bot的日志中，若没有任何bot登录则不进行任何行为
> 2. 生命周期函数的%上下文%不是Mirai事件，因此依赖于Mirai事件的函数统统失效。建议在此进行变量初始化，访问网络等操作。
> 3. 在此函数内获取的变量请使用`置全局变量`函数将信息设置到全局变量里，然后在其他地方进行操作
>
> 以下为生命周期的例子:在console端加载词库时会将本该发送到群里的消息发送到日志中
>
> ```text
> #Seiko词库
> #主人:485184047
> 
> [群]测试
> ok!
> 
> [函数]初始化
> 初始化完成，欢迎使用SeikoDIC!
> 
> [函数]被销毁
> Opps...
> ```

## 2.纯文本

在指令后一定会出现一个纯文本，不然伪代码不会发送任何消息 
若想让bot在触发指令后发送一段话，直接写入你想发送的消息即可。例如：

```text
[群]早上好
欧尼酱早上好~\n
今天是星期日~
```

如上伪代码被加载后，当群里的一个人发送早上好时，bot将会发送第二行和第三行信息。_(以后详细信息会省略。以此精简文档体积)_
> 我们约定使用\n来作为伪代码的换行符。当此符号出现时，将会换一行再输出。

## 3.变量

### 3.1 访问形式

Seiko的变量访问方式有两种：**基础访问**和**增强访问**(实验性)

- **基础访问**的形式是`%变量名%`。在纯文本中，带有%变量名%的字样会被伪代码引擎替换成别的字符。例如:

```text
[群]我的QQ
您的QQ是:%QQ%
```

如上伪代码被**我**加载后发送的是`你的QQ:485184047`  

- **增强访问**主要用于提供一种方便快捷的方式以访问集合中的变量。其形式是`{链式表达式1::伪元素1.链式表达式2::伪元素2::伪原宿3}...`。

	链式表达式由若干个元素构成，元素之间由**英文点句号**连接。

	特别的，我们称第一个元素为根变量、第N个元素向左数一位的元素为父变量、右数一位的元素为子变量。

	链式表达式中的可用元素如下:

| 元素形式       | 解释                                                        |
| -------------- | ----------------------------------------------------------- |
| `变量名`       | 代表父变量中键为`变量名`的**集合/数组/字符串/数字**         |
| `数组名(下标)` | 代表数组中的第`下标`个元素，可能是**集合/数组/字符串/数字** |

| 伪元素 | 解释                           |
| ------ | ------------------------------ |
| len    | 获取数组/集合的长度            |
| kArr   | 仅适用于集合，获取集合的键列表 |
| vArr   | 仅适用于集合，获取集合的值列表 |

下面是几个利用增强访问获取变量的例子：*(其中涉及的函数可以通过下面的函数表查看)*

```text
[群]增强表达式测试1
$集合导入 col {"num":1,"str":"2","bool":true,"col":{"a":"a","b":10,"c":true},"ary":[1,2,3,"4",true,{"a":"A"}]}$
$变量赋值 A {col.num}$
$变量赋值 B {col.ary(2)}$
$变量赋值 D a$
$变量赋值 C {col.ary(5).%D%}$
%A%-%B%-%C%-%D%

[群]增强表达式测试2
$集合导入 col {"num":1,"str":"2","bool":true,"col":{"a":"a","b":10,"c":true},"ary":[1,2,3,"4",true,{"a":"A"}]}$
原集合:%col%({col})\n
num的值:{col.num}\n
str的值:{col.str}\n
col内的c属性:{col.col.c}\n
ary内第三个元素:{col.ary(2)}\n
ary内最后一个元素的a属性:{col.ary(5).a}\n
$变量赋值 dym a$
动态结果:{col.ary(5).%dym%}\n

[群]伪元素测试
$集合导入 K {"A":1,"B":2,"C":{"A":1,"B":2,"C":[1,2,3,4,5]}}$
{K}\n
A的个数{K::len}\n
A的键列表{K::kArr}\n
A的值列表{K::vArr}\n
A的键长度{K::kArr::len}\n
A中C的长度{K.C::len}\n
键列表取值测试:{K::kArr(2)}
值列表取值测试:{K::vArr(2)::kArr}
```



如上代码依次执行后，发送的信息依次为:

```text
1-3-A-a

原集合:{str=2, col={a=a, b=10, c=true}, bool=true, num=1, ary=[1, 2, 3, 4, true, {a=A}]}({str=2, col={a=a, b=10, c=true}, bool=true, num=1, ary=[1, 2, 3, 4, true, {a=A}]})
num的值:1
str的值:2
col内的c属性:true
ary内第三个元素:3
ary内最后一个元素的a属性:A
动态结果:A

{A=1, B=2, C={A=1, B=2, C=[1, 2, 3, 4, 5]}}
A的个数3
A的键列表[A, B, C]
A的值列表[1, 2, {A=1, B=2, C=[1, 2, 3, 4, 5]}]
A的键长度3
A中C的长度3
键列表取值测试:C
值列表取值测试:[A, B, C]
```

> <注>:
>
> 1. 增强表达式遇到下列情况则不会解析:
> 	1. 根变量不存在
> 	2. 最靠近根变量的某一元素的父变量不存在
> 2. 为防止`增强变量不解析`的情况，请按照以下方法排查:
> 	1. 使用`$变量检验$`传入根变量。为true则证明根变量存在
> 	2. 使用`$变量提取$`为表达式赋值。若表达式不解析则此函数会报错

### 3.2 内置变量

伪代码执行过程中内置了一些变量。具体得看是这个指令隶属于哪个事件。

#### 下表是所有事件都会内置的变量：

| 变量名 |                            类型 | 介绍                                                         | 备注                                                         |
| ------ | ------------------------------: | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 上下文 |        JavaObject(MessageEvent) | 获得当前的消息包对象                                         | 搭配`$java方法运行$`使用                                     |
| 缓冲区 | JavaObject(MessageChainBuilder) | 准备发送的消息串                                             | 搭配`$java方法运行$`使用                                     |
| 时间戳 |                            数字 | 获取伪代码被执行的时间                                       | 无                                                           |
| 文本   |                          字符串 | 获取触发伪代码的文本                                         | 无                                                           |
| 参数N  |                          字符串 | 以空格为分割线，获取分割后字符串列表的元素                   | 若%文本%为`主人 早安`，则%参数0%是主人,%主人%是早安          |
| 参数长 |                            数字 | 获取上面`参数N`的长度                                        | 无                                                           |
| 括号N  |                          字符串 | 正则表达式若存在括号，则匹配到括号的内容会存放进括号N里，以1开始。 | 若括号被匹配多次，则若想获取第X次匹配的括号内容，写法是:`%括号X_Y%`，X为匹配的类，Y为组别。<br />~~此特性可能会在未来删除，因为我没有找到触发伪代码的指令还能存在多个括号组的对象~~ |
| 括号组 |                            数字 | %括号N%能取到的最大N值                                       | 若括号被匹配多次，若想获取第X次匹配出的括号组个数，写法是：`%括号组N%`<br />~~此特性可能会在未来删除，因为我没有找到触发伪代码的指令还能存在多个括号组的对象~~ |

> 为方便理解，现给出括号N的示例：
>
> ```text
> [群]我今年(.*{1,2})岁了，我知道原神的椅子可以(.*)
> %括号1%\n
> %括号2%\n
> 从你的年龄是%括号1%岁可以看出：你是一个若智\n
> 你居然知道原神的椅子可以%括号2%，真的太厉害了！
> ```
>

> [你可以在这里找到所有事件都会内置的内建变量](src/main/java/com/kagg886/seiko/dic/session/AbsRuntime.java)

#### 下表是群事件内置的变量

| 变量名  | 类型  | 作用                  |                      备注                       |
|------|-----|---------------------|:---------------------------------------------:|
| 群号   | 数字  | 获得发送此消息的群号          |                       无                       |
| 群名称  | 字符串 | 获得发送此消息的群名称         |                       无                       |
| QQ   | 数字  | 获得发送此消息的QQ号         |                       无                       |
| 昵称   | 字符串 | 获得发送此消息的QQ昵称        |                       无                       |
| 群名片  | 字符串 | 获得发送此消息的QQ在这个群里的群名片 |                       无                       |
| BOT  | 数字  | 接收到此消息的bot的QQ号      |                       无                       |
| 特殊头衔 | 字符串 | 获得发送此消息的QQ的特殊头衔     |               若无特殊头衔则和活跃头衔保持一致                |
| 头衔   | 字符串 | 获得发送此消息的QQ的活跃头衔     |                       无                       |
| 权限   | 字符串 | 获得发送此消息的QQ的权限字符串    | OWNER为群主<br/>ADMINISTRATOR为管理员<br/>MEMBER为群成员 |
| 权限代码 | 数字  | 获得发送此消息的QQ的权限字符串    |                   群主＞管理员＞成员                   |
| 艾特N  | 数字  | 获得发送此消息的QQ本次艾特的人的QQ |    若没有的话则此变量不会被替换<br/>实际使用应写成:`艾特0`,`艾特1`     |
| 艾特数  | 数字  | 获得发送此消息的QQ本次艾特的人的个数 |                       无                       |
| 图片N  | 字符串 | 获得发送此消息的QQ本次发送的图片链接 |                   同:**艾特N**                   |
| 图片数  | 数字  | 获得发送此消息的QQ发送的图片张数   |                       无                       |
| 语音链接 | 字符串 | 获得接收到的语音链接          |            匹配指令应写成`[群][语音链接]`(未测试)            |
| 语音秒数 | 数字  | 获得接受到的语音持续时间        |                       无                       |

> [你可以在这里找到群消息的内置变量](src/main/java/com/kagg886/seiko/dic/session/impl/GroupMessageRuntime.java)

#### 下表是好友事件内置的变量

| 变量名 | 类型  | 作用             | 备注  |
|-----|-----|----------------|:---:|
| QQ  | 数字  | 获得发送此消息的QQ号    |  无  |
| 昵称  | 字符串 | 获得发送此消息的QQ昵称   |  无  |
| BOT | 数字  | 接收到此消息的bot的QQ号 |  无  |
| 备注  | 字符串 | 获得bot为其设置的备注   |  无  |

> [你可以在这里找到好友消息的内置变量](src/main/java/com/kagg886/seiko/dic/session/impl/FriendMessageRuntime.java)

#### 下表为群成员事件都会内置的变量

| 变量名 | 类型   | 作用                    | 备注 |
| ------ | ------ | ----------------------- | ---- |
| 群号   | 数字   | 获得发送此消息的群号    | 无   |
| 群名称 | 字符串 | 获得发送此消息的群名称  | 无   |
| QQ     | 数字   | 获得发送此消息的QQ号    | 无   |
| BOT    | 数字   | 接收到此消息的bot的QQ号 | 无   |
| 昵称   | 字符串 | 获得发送此消息的QQ昵称  | 无   |

> [你可以在这里找到群成员事件的内置变量](src/main/java/com/kagg886/seiko/dic/session/impl/GroupMemberRuntime.java)
>
> **注**:针对不同的群成员事件所增加的变量，请前往`三.1`中的`关于群事件说明`的表格中查询

## 4.计算

SeikoDIC支持算数，但是你要为它们套上方括号**必须是英文半角！**

```text
[群]计算
5+3=[5+3]\n
114+514=[114+514]\n
sin(pi/6)=[sin(pi/6)]
```

> 方括号内的计算请用圆括号来划分运算次序

如上伪代码被加载后，输出结果是`5+3=8...(后略)`  
如果不套方括号，则只会输出`5+3=5+3...(后略)`

若出现计算不合法的情况则会输出NaN，例如除数是0等等。

自0.1.1起，Seiko支持在方括号表达式中嵌入基本初等函数。格式为:`函数(值1,值2...)`，可用的函数如下:

| 函数   | 参数数量 | 功能                                                         |
| ------ | -------- | ------------------------------------------------------------ |
| sin    | 1        | 正弦                                                         |
| cos    | 1        | 余弦                                                         |
| tan    | 1        | 正切                                                         |
| cot    | 1        | 余切                                                         |
| log    | 1        | 取对数，底数为e                                              |
| log2   | 1        | 取对数，底数为2                                              |
| log10  | 1        | 取对数，底数为10                                             |
| abs    | 1        | 绝对值                                                       |
| asin   | 1        | 反正弦                                                       |
| acos   | 1        | 反余弦                                                       |
| atan   | 1        | 反正切                                                       |
| cbrt   | 1        | 开立方                                                       |
| sinh   | 1        | 双曲正弦函数                                                 |
| sqrt   | 1        | 开平方                                                       |
| tanh   | 1        | 双曲正切                                                     |
| cosh   | 1        | 双曲余弦                                                     |
| ceil   | 1        | 向上取整                                                     |
| pow    | 2        | 幂指数运算。<br />第一个参数为底数，第二个原数为指数。<br />相比`^`，pow函数的隐藏bug可能更少 |
| empm1  | 1        | 返回e^x-1                                                    |
| signum | 1        | 符号函数sgn(x)                                               |

## 5.条件表达式

SeikoDIC支持条件表达式，以下伪代码展示了如何使用它：

```text
[群]早上好
早上好鸭~
如果:%QQ%==485184047
今天又是美好的一天呢
返回
如果尾
要不要贴贴——
```

`如果`会匹配它冒号后的表达式，若为true则执行返回前的伪代码。
若为false则跳转到`如果尾`后，若全文都无如果尾则终止此词条的执行。 

## 6.函数(重要)

Seiko使用`$`包裹字符串的两头来实现函数功能。例如:`$函数 函数参数$`  
但是与Seiko的函数与SQ系伪代码函数略有不同。在学习前请看下面的预备知识：

### 6.1预备知识：

- Seiko的函数分为两类：阻断函数和非阻断函数：  
  所谓阻断函数就是在伪代码引擎调用此函数前会发送在执行此条消息前的所有消息。
  非阻断函数则不会出现此效果。  
  让我们举个例子：在下面的结果中，将会先输出`开始延时了！`，然后等待1秒后输出`延时成功！`和**自己的QQ图片**在一起的图文消息
- 若函数的参数为单纯的变量表达式，则Seiko会将其替换成引用池里的对象而不是字符串

```text
[群]延时
开始延时了！
$延时 1000$
延时成功！
$图片 https://q1.qlogo.cn/g?b=qq&nk=485184047&s=640$
```

- Seiko函数不支持嵌套调用
- [^1]: 参数列表中，**明文写入的变量值类型均为字符串**(计算值也一样!)
- 标斜体的方法名为已废弃，这类方法将不再维护。

### 6.2函数列表

- **变量类**(操作变量等)

| 名字       | 参数个数 | 调用说明                                                  | 函数类型   | 说明                                                         | 调用示例                                    |
| ---------- | -------- | --------------------------------------------------------- | ---------- | ------------------------------------------------------------ | ------------------------------------------- |
| 变量删除   | 1        | `$变量删除 变量名$`                                       | 非阻断函数 | 删除变量                                                     | `$变量删除 QQ$`                             |
| 变量检验   | 2        | `$变量检验 要存入的变量 要检验的变量 是否输出类名(可选)$` | 非阻断函数 | 检验变量是否为空<br />若选择输出类名，则结果是Java对象的类名<br />否则输出true/false | `$变量检验 A B$`<br />`$变量检验 A B true$` |
| 变量赋值   | 2        | `$变量赋值 变量名 值$`                                    | 非阻断函数 | 为一个变量赋值                                               | `$变量赋值 K V$`                            |
| 取全局变量 | 2        | `$取全局常量 存入变量 索引值或键$`                        | 非阻断函数 | 若为索引值则从词库头中获取第n个数据<br />若为键则获取下面`取全局变量`中的值 | `$取全局常量 A 1$`                          |
| 置全局变量 | 2        | `$置全局变量 键 值$`                                      | 非阻断函数 | 设置全局变量。全局变量在伪代码的任意一个函数内均可使用`取全局变量`获取到 | `$置全局变量 A 1$`                          |
| 变量提取   | 3        | `$变量提取 存入变量 链式表达式$`                          | 非阻断函数 | 按照链式表达式的规范获取值                                   | 详见下方                                    |

> 对于变量提取中的链式表达式的说明:(其实和增强访问一样了，只不过这是早期SeikoDIC提供的函数)
>
> 1. 若对集合A(内容是{"key":"abc","tags":[{"id":123456},{"id":789012}]})
     为例，获取tag里的第一个元素的id的链式表达式为`A.tags(0).id`
> 2. 若对集合A(内容是[{"id":123456},{"id":789012}]为例，获取tag里的第一个元素的id的链式表达式为`A(0).id`

- **集合类**(用于对`键值对`或`数组`进行操作的命令。)

	> 1. 表内命令除`集合创建`外，提到的集合都表示为`键值对`或`数组`)
	> 2. 若集合名代表的是数组，则表内提到的键则必须为数字

| 名字     | 参数个数 | 调用说明                                     | 函数类型   | 说明                                                  | 调用示例                                                     |
| -------- | -------- | -------------------------------------------- | ---------- | ----------------------------------------------------- | ------------------------------------------------------------ |
| 集合创建 | 1        | `$集合创建 变量名$`                          | 非阻断函数 | 声明一个集合，可以往集合里放各种数据                  | `$集合创建 A$`                                               |
| 集合导入 | 2        | `$集合导入 变量名/变量 要转化的字符串$`      | 非阻断函数 | 声明一个集合并赋值，支持XML JSON HTTP头和Cookie表达式 | `$集合导入 A {"a":"b","c":"d","e":114514,"f":true,"g":{"h":"k","m":"n"}}$` |
| 取集合   | 3        | `$取集合 变量名/变量 集合名 键$`             | 非阻断函数 | 获取集合内一个键代表的值                              | `$取集合 A0 A a$`<br />`$取集合 A0 A 3$`                     |
| 集合赋值 | 3        | `$集合赋值 集合名/变量 集合变量 要赋予的值$` | 非阻断函数 | 向一个集合里添加一个键值对。                          | `$集合赋值 A B C$`                                           |
| 集合长   | 2        | `$集合长 存入变量名 集合名/集合变量$`        | 非阻断函数 | 获取一个集合的长度                                    | `$集合长 A B$`                                               |
| 集合删除 | 2        | `$集合删除 集合名/集合变量 集合变量$`        | 非阻断函数 | 删除集合中的一个数据，以键为索引                      | `$集合删除 A B$`                                             |
| 集合转   | 2        | `$集合转 集合名/集合变量 转入变量名$`        | 非阻断函数 | 将集合对象转成json字符串                              | `$集合转 A B$`                                               |

- **数组类**(用于对`数组`操作的命令)

| 名字       | 参数个数 | 调用说明                                           | 函数类型   | 说明                                                         | 调用示例                                 |
| ---------- | -------- | -------------------------------------------------- | ---------- | ------------------------------------------------------------ | ---------------------------------------- |
| 数组创建   | 1        | `$数组创建 数组名$`                                | 非阻断函数 | 创建一个数组                                                 | `$数组创建 A$`                           |
| *数组导入* | 2        | `$数组导入 存入变量名 数组字符串(json格式)$`       | 非阻断函数 | 将一个字符串转成数组(写死的字符串支持空格)                   | `$数组导入 A [1,2,3,4,5]$`               |
| *数组删除* | 2        | `$数组删除 数组名/数组变量 序号$`                  | 非阻断函数 | 删除数组对应序号的内容                                       | `$数组删除 A 0$`<br />`$数组删除 %A% 0$` |
| *数组赋值* | 3或2     | `$数组赋值 数组名/数组变量 添加的变量 序号(可选)$` | 非阻断函数 | 若序号存在，则将对应序号的内容替换为新内容。<br />若序号不存在则在末尾追加 | `$数组赋值 A A$`<br />`$数组赋值 A A 2$` |
| *取数组*   | 3        | `$取数组 数组名/数组变量 序号 存入变量$`           | 非阻断函数 | 获取数组对应序号的内容。<br />类型可能为字符串，数字，集合或数组 | `$取数组 A 1 B$`                         |
| *数组长*   | 2        | `$数组长 数组名/数组变量 存入变量$`                | 非阻断函数 | 获取数组的长度                                               | `$数组长 A B$`                           |
| *数组转*   | 2        | `$数组转 数组名/数组变量 存入变量$`                | 非阻断函数 | 将数组转成json字符串                                         | `$数组转 A B$`                           |

- **文件类**(持久化存储/读取变量)

| 名字   | 参数个数 | 调用说明                                             | 函数类型   | 说明                                                       | 调用示例                                                 |
| ------ | -------- | ---------------------------------------------------- | ---------- | ---------------------------------------------------------- | -------------------------------------------------------- |
| 读     | 4或3     | `$读 变量名 文件 键 值$`<br /> `$读 变量名 文件 键$` | 非阻断函数 | 读取文件，然后读取键。若键不存在则返回值(值那里可以不用写) | `$读 A sss.txt key value$` <br />`$读 A sss.txt key$`    |
| 写     | 3        | `$写 文件 键 值$`                                    | 非阻断函数 | 写入键值对到文件中                                         | `$写 sss.txt A key$`<br />`$写 sss.txt A 集合/数组对象$` |
| 读文件 | 2        | `$读文件 存入变量名 文件路径$`                       | 非阻断函数 | 从文件路径中读取全部文字到变量名中                         | `$读文件 A a.txt$`                                       |
| 写文件 | 2        | `$写文件 文件内容 文件路径$`                         | 非阻断函数 | 写入文件内容到文件路径中                                   | `$写文件 %STR% a.txt$`                                   |
| 删     | 1        | `$删 文件路径$`                                      | 非阻断函数 | 删除文件(支持文件夹)                                       | `$删 b.txt$`                                             |

- **字符串类**(提供快捷操作字符串的快捷方法)

| 名字     | 参数个数 | 调用说明                                                    | 函数类型   | 说明                                                         | 调用示例                                                   |
| -------- | -------- | ----------------------------------------------------------- | ---------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| 文字替换 | 4或3     | `$文字替换 变量名 被替换文字 替换成文字 存入变量(可选)$`    | 非阻断函数 | 将`变量内的`被替换文字`替换成`替换成文字                     | `$文字替换 A 114 514$`<br />`$文字替换 A 114 514 B$`(下略) |
| 文字分割 | 3或2     | `$文字分割 待分割变量名 分割符号 存入变量(可选)$`           | 非阻断函数 | 将`待分割变量名`按照`分割符号`分割成集合对象                 | `$文字分割 A t$`                                           |
| 文字查索 | 3或2     | `$文字查索 待查询变量名 查询的文字 存入变量(可选)$`         | 非阻断函数 | 获得`待查询变量名中，第一次出现`查询的文字`的下标  | `$文字查索 A 草$` |                                                            |
| 文字匹配 | 3或2     | `$文字匹配 待匹配变量名 要匹配的正则表达式 存入变量(可选)$` | 非阻断函数 | 将`待匹配变量`与`正则表达式`做匹配，返回true/false           | `$文字匹配 K [0-9]+$`                                      |
| 文字包含 | 3或2     | `$文字包含 待匹配变量名 文字 存入变量(可选)$`               | 非阻断函数 | 检验`带匹配变量`是否包含`文字`                               | `$文字包含 A qwq$`                                         |
| 转大写   | 2或1     | `$转大写 变量名 存入变量(可选)$`                            | 非阻断函数 | 将变量中的小写字母转成大写                                   | `$转大写 A$`                                               |
| 转小写   | 2或1     | `$转小写 变量名 存入变量(可选)$`                            | 非阻断函数 | 将变量中的小写字母转成大写                                   | `$转小写 A$`                                               |
| 格式化   | 3或更多  | `$格式化 变量名 待插入字符串 参数$`                         | 非阻断函数 | 格式化一个字符串                                             | `$格式化 A 我关注了%s个虚拟主播 10$`[^1]                   |

> 1. 字符串函数的存入变量是可填参数(除格式化外)。若不填写此参数，则操作结果会覆盖掉源

- **时间类**(与时间转换有关的函数)

| 名字     | 参数个数 | 调用说明                                        | 函数类型   | 说明                     | 调用示例                            |
| -------- | -------- | ----------------------------------------------- | ---------- | ------------------------ | ----------------------------------- |
| 转时间戳 | 3        | `$转时间戳 存入变量 时间格式字符串 时间字符串$` | 非阻断函数 | 时间格式化字符串转时间戳 | `$转时间戳 A yyyy-MM-dd 2023-3-19$` |
| 转时间   | 3        | `$转时间 存入变量 格式化字符串 毫秒时间戳$`     | 非阻断函数 | 时间戳转时间格式化字符串 | `$转时间 A yyyy-MM-dd 毫秒时间戳$`  |

> 若时间格式字符串内含有空格不要直接粘贴，请传入变量

- **消息类**(增强发送的消息，使消息不局限于纯文本)

| 名字       | 参数个数 | 调用说明                                                     | 函数类型   | 说明                                                         | 调用示例                                                     |
| ---------- | -------- | ------------------------------------------------------------ | ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 图片       | 1        | `$图片 图片url$`                                             | 非阻断函数 | 向消息链里添加一张图片                                       | `$图片 https://q1.qlogo.cn/g?b=qq&nk=%QQ%&s=640$`            |
| 艾特       | 1        | `艾特 qq号`                                                  | 非阻断函数 | 向消息链中添加艾特信息。                                     | `$艾特 485184047$`                                           |
| 语音       | 3或2     | `$语音 [群/好友] [群号/好友qq] 语音链接$` `$语音 %上下文% 语音链接$` | 阻断函数   | 发送语音消息，**使用mp3会导致电脑端听不了**                  | `$语音 %上下文% https://www.text-to-speech.cn/mp3/1193435796_1674957193_0.mp3$` `$语音 群 123456789 https://www.text-to-speech.cn/mp3/1193435796_1674957193_0.mp3$` `$语音 好友 1234 https://www.text-to-speech.cn/mp3/1193435796_1674957193_0.mp3$` |
| 设置接收者 | 1        | `$设置接收者 %群对象/成员对象/好友对象%$ `                   | 阻断函数   | 见下                                                         | 见下                                                         |
| 设置回复   | 2        | `$设置回复 %上下文% 待回复文字(可选)$`                       | 阻断函数   | 为即将发送的消息指定一个回复对象，文本为自定义显示内容       | `$设置回复 %上下文%$`<br />`$设置回复 %上下文% 披萨的价格是九磅十五便士$` |
| 撤回       | 1        | `$撤回 %上下文%$`                                            | 非阻断函数 | 撤回该上下文代表的消息<br />tips:上下文其实是可以存储进全局变量的 | `$撤回 %上下文%$`                                            |

> 关于`设置接收者`的用途:
>
> 可以修改缓冲区最终会发送的目标，其中这里面的对象必须符合SeikoDIC供给的格式。无论此对象是生成的还是自己构建的：
>
> 以下是将一条消息发送给群内所有成员的例子:
>
> ```text
> [群]群发
> $群成员列表 A %上下文%$
> $集合长 B A$
> $调用 群发 %B% NUM$
> 
> [函数]群发
> $设置接收者 {A(%NUM%)}$
> 这是一条群发的消息!
> ```
>
> 

- **控制类**(控制消息发送的时机等)

| 名字     | 参数个数 | 调用说明                                                     | 函数类型   | 说明                                               | 调用示例      |
| -------- | -------- | ------------------------------------------------------------ | ---------- | -------------------------------------------------- | ------------- |
| 延时     | 1        | `$延时 毫秒数$`                                              | 阻断函数   | 延时后执行后面的代码，单位为毫秒                   | `$延时 1000$` |
| 调用     | 1或2或3  | `$调用 方法名 循环次数(可选) 循环变量(可选) 存储变量名(可选)$` | 非阻断函数 | 调用词库内定义的词条                               | 详见下方      |
| 异步调用 | 2或3     | `$异步调用 词库方法名 注册的键变量(可选)$`                   | 非阻断函数 | 新开一个线程调用词库内的函数，上下文继承被调方法的 | 详见下方      |

> 关于**调用**的写法：
>
> 1. 被调用的词条的事件必须是`[函数]`。
> 2. 进入被调函数后，被调函数可以访问调用者的变量。
> 3. 被调函数执行后默认会发送存储的信息。若禁止这种行为，请在最后一行加`返回`
> 4. 以下是示例1：在这个示例中，会发送两条消息。第一条为`准备调用...`，第二条为`赋值完成`和`返回值:1`
     > 在一起的消息。若去掉`返回`，则会发送三条消息。
>
> ```text
> [群]调用测试
> 准备调用...
> $调用 函数A$
> 返回值:%A%
> 
> [函数]函数A
> $变量赋值 A 1$
> 赋值完成!
> 返回
> ```
>
> 5. 以下是示例2：在这个示例中，自增的循环变量会存入到A中供`方法0`使用，故会发送以下消息：
>
> ```text
> 调用开始
> 0
> 1
> 2
> 调用完成
> ```
>
> ```text
> [群]测试
> 调用开始\n
> $调用 方法0 3 A$
> 调用完成\n
> 
> [函数]方法0
> %A%\n
> 返回
> ```
>
>

- **Bot类**(对Bot进行操作)
	
  此块方法较多且未经标识一律为非阻断函数，需要一个一个命令讲解
	
	- BOT列表
		- 调用方式:`$BOT列表 存入变量$`
  	- 返回:一个数组，里面包含了已登入的所有botQQ
  
  - 群列表
  	- 调用方式:`$群列表 存入变量 %上下文%/bot账户$`
  	- 返回:由集合构成的数组列表，里面包含了以下信息
  
  | 名称          | 解释                                                         |
  | ------------- | ------------------------------------------------------------ |
  | 类型          | 固定值，为`群`                                               |
  | BOT           | 这个群集合对象所属的bot                                      |
  | 群号          | 这个群的群号                                                 |
  | 群名称        | 这个群的名字                                                 |
  | 群主          | 这个群的群主的QQ                                             |
  | 设置          | 群聊的设置，也是一个集合对象。这个集合对象的属性在下面说明，以`设置.XXX`介绍 |
	| 设置.允许邀请 | 此群是否允许非管理员邀请新成员                               |
	| 设置.匿名消息 | 此群是否允许匿名操作                                         |
  | 设置.全员禁言 | 此群是否开启全员禁言                                         |
	| 设置.自动审批 | 此群是否开启某管家自动审批入群                               |
	
	- 获取群
		- 调用方式:`$获取群 存入变量 %上下文%$ 或 $获取群 存入变量 群号 bot账号$`
		- 返回:一个集合，格式同`群列表`函数
		
	- 好友列表
	
	  - 调用方式:`$好友列表 存入变量 %上下文%/bot账户$`
	  - 返回:由集合构成的数组列表，里面包含了以下信息:
	
	  | 名称 | 解释                      |
	  | :--- | :------------------------ |
	  | 类型 | 固定值，为`好友`          |
	  | BOT  | 这个好友集合对象所属的bot |
	  | QQ   | 好友QQ                    |
	  | 昵称 | 好友昵称                  |
	  | 备注 | 你给好友的备注            |
	  | 分组 | 这个好友的分组名          |
	
	- 获取好友
	
	  - 调用方式:`$获取好友 存入变量 %上下文%$ 或 $获取好友 存入变量 好友qq bot账号$`
	  - 返回:一个集合，格式同`好友列表`函数
	
- **群类**(对群单体进行操作)

  - 退群
    - 调用方式:`$退群 群号 bot账号(可选)$ 或 $退群 %上下文%$`
    - 注意:
      1. 群主不可以退群

  - 获取群公告
    - 调用方式:`$获取群公告 存入变量 群号 bot账号(可选)$ 或 $获取群公告 存入变量 %上下文%$`
    - 返回:又集合构成的数组列表，里面包含了以下信息:
  
  | 名称                | 解释                                                         |
  | ------------------- | ------------------------------------------------------------ |
  | ***内容***          | 公告的文字信息                                               |
  | FID                 | 群公告的标识符，腾讯依靠此字段获取公告                       |
  | 发送者              | 发送此公告的人的qq，不能确定此人是否退群                     |
  | 已确认人数          | 已经确认此公告的人                                           |
  | 公布时间戳          | 发布此公告的时间戳                                           |
  | 源对象              | 公告源对象，是JavaObject                                     |
  | *属性*              | 也是一个集合对象。这个集合对象的属性在下面说明，以`属性.XXX`介绍 |
  | *属性.发送给新成员* | 固定值，为true/false。为true代表此公告将会在新人进群时弹屏   |
  | *属性.置顶*         | 固定值，为true/false。为true代表此公告为置顶公告             |
  | *属性.需要确认*     | 固定值，为true/false。为true代表此公告需要群成员确认         |
  | *属性.图片*         | 保留对象值，目前固定传null                                   |
  
  > 值得一提的是，截止到2.15.0-M1，Mirai协议仍不支持从群公告中获取图片链接。让我们继续等待...
  
  - 删除群公告
    - 调用方式:`$删除群公告 %公告集合%$`
    - 说明:传入的对象是`$获取群公告$`函数返回的对象，也可以是上文返回对象里的源对象
  - 发布群公告
    - 调用方式:`$发布群公告 %公告集合% 群号 bot账号(可选)$ 或 $发布群公告 %公告集合% %上下文%$`
    - 说明:
      1. 公告集合的结构与上文`获取群公告`类似。(加斜体为可以添加的属性，加粗为必须填充的字段)
      2. 图片目前只能填HTTP链接

- **群成员类**(对群成员进行操作)
  *此块方法较多且未经标识一律为非阻断函数，需要一个一个命令讲解*

  - 群成员列表
  	- 调用方式:`$群成员列表 存入变量 群号 bot账号(可选)$ 或 $群成员列表 存入变量 %上下文%$`
  	- 返回:由集合构成的数组列表，里面包含了以下信息:

  | 名称           | 解释                                              |
  | -------------- | ------------------------------------------------- |
  | 类型           | 固定值，为`群成员`                                |
  | QQ             | 群成员的QQ                                        |
  | 群号           | 此列表属于的群号                                  |
  | BOT            | 此函数是由哪个bot调用的                           |
  | 昵称           | 群成员的昵称                                      |
  | 群名片         | 群成员的群名片，未设置时为空                      |
  | 权限           | 权限字符串(OWNER,ADMIN,MEMBER)                    |
  | 权限代码       | 权限代码(群主为2 管理员为1 群成员为0)             |
  | 特殊头衔       | 群主为其授予的自定义头衔                          |
  | 加群时间戳     | 群成员的加群时间                                  |
  | 禁言剩余       | 若被禁言，则此项为一个非0整数，代表禁言结束的秒数 |
  | 最近发言时间戳 | 群成员最后一次说话的时间                          |

  - 改名
    - 调用方式:`$改名 新的群名片 QQ 群号(可选) bot账号(可选)$ 或 $改名 新的群名片 %上下文%$ 或 $改名 新的群名片 集合对象$`
    - 注意:
      1. 不允许使用null占位
  - 管理员
    - 调用方式:`$管理员 上/下 QQ 群号(可选) bot账号(可选)$ 或 $管理员 上/下 %集合对象%$ 或 $管理员 上/下 %上下文%$`
    - 注意:
      1. 必须是群主才能调用这个方法
  - 踢
    - 调用方式:`$踢 %上下文%$ 或 $踢 QQ$ 或 $踢 QQ 群号$ 或 $踢 QQ 群号 bot账号$ 或 $踢 %集合对象%$`
    - 注意:
      1. 不允许使用null占位
      2. 不支持自定义踢人信息，因为新版手机qq好像看不了这玩意...自定义了也没啥用我觉得x
  - 群名片
    - 调用方式: `$群名片 名片名 QQ 群号(可选) bot账号(可选)$ 或 $群头衔 头衔名 %集合对象%$ 或 $群头衔 头衔名 %上下文%$`
    - 注意:
    	1. 不允许使用null占位
    	2. 群头衔限6个字符
  - 群头衔
    - 调用方式: `$群头衔 头衔名 QQ 群号(可选) bot账号(可选)$ 或 $群头衔 头衔名 %集合对象%$ 或 $群头衔 头衔名 %上下文%$`
    - 注意:
      1. 不允许使用null占位
      2. 群头衔限6个字符
  - 群成员
    - 调用方式:`$群成员 存入变量 QQ号 群号 bot账号(可选)$ 或 $群成员 存入变量 %上下文%$`
    - 注意:
      1. 返回集合对象，可用于其他操作、
      2. 不允许使用null占位
  - 禁言
    - 调用方式: `$禁言 时长(秒为单位) QQ 群号(可选) bot账号(可选)$ 或 $禁言 时长(秒为单位) %上下文%$ 或 $禁言 时长(秒为单位) 集合对象$`
    - 注意:
             1. 不允许使用null占位
             2. 禁言时间为0则视为解禁
             3. 集合对象的格式和`群成员列表`包含的对象相同 

- **未分类的其他方法**

| 名字         | 参数个数 | 调用说明                                                     | 函数类型   | 说明                                                         | 调用示例                                                     |
| ------------ | -------- | ------------------------------------------------------------ | ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 随机数       | 2或1     | `$随机数 存入变量名 最小值 最大值$`<br />`$随机数 存入变量名 最大值$` | 非阻断函数 | 生成一个随机数并存放到变量名中(左闭右开区间)<br />若只填一个参数默认下界为0 | `$随机数 A 1 3$`<br />`$随机数 A 2$`                         |
| JAVA方法运行 | 5或4     | `$JAVA方法运行 存入变量 类名(全限定) 方法名 对象 参数列表$` `$JAVA方法运行 存入变量 类名(全限定) 方法名 对象$` | 非阻断函数 | 使用反射调用java方法，配合上文的JavaObject使用               | `$JAVA方法运行 A net.mamoe.mirai.event.events.GroupMessageEvent getSenderName %上下文%$` `$JAVA方法运行 A java.lang.String contains 114514 4$` |
| 日志         | 2        | `$日志 优先级 内容$`                                         | 非阻断函数 | 发送日志                                                     | `$日志 2 Hello!$`<br />`$日志 I Hello!$`<br />`$日志 INFO Hello!$` |
| 访问         | 见下方   | 见下方                                                       | 阻断函数   | 访问一个网址，并将结果转成字符串存入 头集合和参数集合为可选选项，传入类型为集合 | 见下方                                                       |

> ## 关于日志的优先级参数:(区分大小写)
>
> | 全称    | 简称 | 代号 |
> | ------- | ---- | ---- |
> | VERBOSE | V    | 0    |
> | DEBUG   | D    | 1    |
> | INFO    | I    | 2    |
> | WARN    | W    | 3    |
> | ERROR   | E    | 4    |
>
> 优先级字符串使用全称，简称，代号均可
>
> 
>
> ## 关于访问的参数和调用：
>
> 1. 访问的调用方式有下列两种：
>
> 	`$访问 结果存入变量 请求方式 网址 %头集合%(可以使用null占位) 参数集合/参数体$`
>
> 	`$访问 结果存入变量 %集合对象%$`
>
> 	下面针对第二种对象内可以传入的值进行讲解：
>
> 	| 键          | 作用                                                         | 是否必选 |
> 	| ----------- | ------------------------------------------------------------ | -------- |
> 	| 请求方式    | 要求传入GET/POST两个固定值                                   | 是       |
> 	| 网址        | 要求传入一个url地址                                          | 是       |
> 	| 头集合      | 要求传入集合                                                 | 否       |
> 	| 参数/参数体 | 可以传入集合，也可以传入字符串                               | 否       |
> 	| 简易信息    | 传入true/false。若传入false则结果存入的是字符串<br />传入true则结果存入的是集合 | 否       |
>
> 2. 针对`简易信息`为false的情况，返回的集合的内容如下：
>
> 	| 键       | 作用                          |
> 	| -------- | ----------------------------- |
> 	| 响应码   | 获取本次请求的状态码，如200等 |
> 	| 响应头   | 获取服务器返回的响应头        |
> 	| 响应内容 | 获取响应内容，为字符串        |
